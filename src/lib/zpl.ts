export interface LabelData {
  id: string;
  productName: string;
  price: number;
  features: string[];
}

const LOGO_GFA = "^GFA,8897,8897,31,,00hWF8,03hWFE,0hYF8,1hYFC,1hYFE,3hYFE,7iF,7F8hV0FF,7FhW07F,7EhW03F8FEhW03F8::::::::::::FEJ03LFEL07gGFCV03F8FEJ03LFEL07gIFU03F8FEJ03LFEL07gJFT03F8FEJ03LFEL07gJFES03F8FEJ03LFEL07gKFCR03F8FEJ03LFEL07gLF8Q03F8FEJ03LFEL07gLFEQ03F8FEJ03LFEL07gMF8P03F8FEJ03LFEL07gMFCP03F8FEJ03LFEL07gNFP03F8FEJ03LFEL07gNFCO03F8FEJ03LFEL07gNFEO03F8FEJ03LFEL07gOFO03F8FEJ03LFEL07gOF8N03F8FEJ03LFEL07gOFEN03F8FEJ03LFEL07gPFN03F8FEJ03LFEL07gPF8M03F8FEJ03LFEL07gPFCM03F8:FEJ03LFEL07gPFEM03F8FEJ03LFEL07gQFM03F8FEJ03LFEL07gQF8L03F8FEJ03LFEL07gQFCL03F8:FEJ03LFEL07gQFEL03F8FEJ03LFEL07gRFL03F8:FEJ03LFEL07LF8N018J0QF8K03F8FEJ03LFEL07LF8N018K0PF8K03F8FEJ03LFEL07LF8N018K03OFCK03F8FEJ03LFEL07LF8N018L0OFCK03F8FEJ03LFEL07LF8M0199CK03NFEK03F8FEJ03LFEL07LF8L01F99F8J01NFEK03F8FEJ03LFEL07LF8L0FF99FFK07MFEK03F8FEJ03LFEL07LF8K03FF99FFCJ03NFK03F8FEJ03LFEL07LF8K07FC183FEJ01NFK03F8FEJ03LFEL07LF8J01FE01807F8J0NF8J03F8FEJ03LFEL07LF8J03F801801FCJ07MF8J03F8FEJ03LFEL07LF8J07E0018007EJ07MF8J03F8FEJ03LFEL07LF8J0FC0018003FJ03MF8J03F8FEJ03LFEL07LF8I01F80018001F8I01MFCJ03F8FEJ03LFEL07LF8I03FI018I0FCI01MFCJ03F8FEJ03LFEL07LF8I03EI018I07CJ0MFCJ03F8FEJ03LFEL07LF8I07CI018I03EJ0MFCJ03F8FEJ03LFEL07LF8I0F8I018I01FJ07LFEJ03F8FEJ03LFEL07LF8I0FJ018J0FJ07LFEJ03F8FEJ03LFEL07LF8001FJ018J0F8I07LFEJ03F8FEJ03LFEL07LF8001EI01998I078I03LFEJ03F8FEJ03LFEL07LF8001EI0799EI07CI03LFEJ03F8FEJ03LFEL07LF8003CI0E187I03CI03LFEJ03F8FEJ03LFEL07LF8003C001C1838003CI03LFEJ03F8FEJ03LFEL07LF8003C0038001C003CI03MFJ03F8FEJ03LFEL07LF80078003J0C001EI03MFJ03F8FEJ03LFEL07LF80078006J06001EI01MFJ03F8:FEJ03LFEL07LF8Y01MFJ03F8:FEJ03LFEL07LF80LF8001LF001MFJ03F8:FEJ03LFEL07LF8Y01MFJ03F8:FEJ03LFEL07LF80078006J06001EI01MFJ03F8:FEJ03LFEL07LF80078003J0C001EI01MFJ03F8FEJ03LFEL07LF8003C0038001C003CI01MFJ03F8FEJ03LFEL07LF8003C001C0838003CI03MFJ03F8FEJ03LFEL07LF8003CI0E187I03CI03LFEJ03F8FEJ03LFEL07LF8001EI0799EI07CI03LFEJ03F8FEJ03LFEL07LF8001EI01998I078I03LFEJ03F8FEJ03LFEL07LF8001FJ018J0F8I03LFEJ03F8FEJ03LFEL07LF8I0FJ018J0FJ07LFEJ03F8FEJ03LFEL07LF8I0F8I018I01FJ07LFEJ03F8FEJ03LFEL07LF8I07CI018I03EJ07LFEJ03F8FEJ03LFEL07LF8I03EI018I03CJ0MFCJ03F8FEJ03LFEL07LF8I03FI018I07CJ0MFCJ03F8FEJ03LFEL07LF8I01F80018001F8I01MFCJ03F8FEJ03LFEL07LF8J0FC0018003FJ01MFCJ03F8FEJ03LFEL07LF8J07E0018007EJ03MF8J03F8FEJ03LFEL07LF8J03F801801FCJ03MF8J03F8FEJ03LFEL07LF8J01FE01807F8J07MF8J03F8FEJ03LFEL07LF8K07FC183FEK0NFK03F8FEJ03LFEL07LF8K03FF99FFCJ01NFK03F8FEJ03LFEL07LF8L0FF99FFK03NFK03F8FEJ03LFEL07LF8L01F99FCK07MFEK03F8FEJ03LFEL07LF8M0399CL0NFEK03F8FEJ03LFEL07LF8N018L01NFEK03F8FEJ03LFEL07LF8N018L07NFCK03F8FEJ03LFEL07LF8N018K01OFCK03F8FEJ03LFEL07LF8N018K07OF8K03F8FEJ03LFEL07LF8N018J07PF8K03F8FEJ03LFEL07gRFL03F8FEJ03LFEL07gQFEL03F8:FEJ03LFEL07gQFCL03F8FEJ03LFEL07gQF8L03F8:FEJ03LFEL07gQFM03F8FEJ03LFEL07gPFEM03F8FEJ03LFEL07gPFCM03F8FEJ03LFEL07gPF8M03F8FEJ03LFEL07gPFN03F8FEJ03LFEL07gOFEN03F8FEJ03LFEL07gOFCN03F8FEJ03LFEL07gOF8N03F8FEJ03LFEL07gOFO03F8FEJ03LFEL07gNFEO03F8FEJ03LFEL07gNF8O03F8FEJ03LFEL07gNFP03F8FEJ03LFEL07gMFCP03F8FEJ03LFEL07gMFQ03F8FEJ03LFEL07gLFCQ03F8FEJ03LFEL07gLFR03F8FEJ03LFEL07gKFCR03F8FEJ03LFEL07gJFES03F8FEJ03LFEL07gJFT03F8FEJ03LFEL07gIFU03F8FEJ03LFEL07gGFCV03F8FEJ03LFEL07LF8gQ03F8:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::FEJ03LFEhK03F8::::::::::::::::::::::::FEJ03hMFEJ03F8:::::::::::::::::::::::::::FEhW03F8::::::::::::7EhW03F87FhW07F,7F8hV0FF,3iF,3hYFE,1hYFC,0hYFC,07hXF,03hWFE,007hVF,";

export function generateZPL(data: LabelData): string {
  const { productName, price, features } = data;

  // Determine price positioning based on number of digits
  const priceString = `$${price}`;
  let priceXPosition = 370;

  // Calculate number of digits in price (including decimal)
  const priceDigits = Math.floor(price).toString().length;

  // Set position based on digit count
  if (priceDigits === 1) {
    priceXPosition = 450;
  } else if (priceDigits === 2) {
    priceXPosition = 410;
  } else if (priceDigits === 3) {
    priceXPosition = 365;
  } else if (priceDigits >= 4) {
    priceXPosition = 320;
  }

  // Build ZPL command
  let zpl = "^XA\n\n";

  // Product name
  zpl += "^CF0,35\n";
  zpl += `^FO25,35^FD${productName}^FS\n`;

  // Price
  zpl += "^CF0,170\n";
  zpl += `^FO${priceXPosition},210^FD${priceString}^FS\n`;

  // Sales tax text
  zpl += "^CF0,32\n";
  zpl += "^FO440,360^FDSales Tax Incl.^FS\n\n";

  // Features
  zpl += "^CF0,29\n";
  const featureYPositions = [90, 120, 150];
  features.forEach((feature, index) => {
    if (index < 3 && feature.trim()) {
      zpl += `^FO276,${featureYPositions[index]}^FD- ${feature}^FS\n`;
    }
  });

  // Logo
  zpl += `\n^FO20,100${LOGO_GFA}^FS\n\n`;

  zpl += "^XZ";

  return zpl;
}

export function createLabelData(
  productName: string,
  price: number,
  features: string[]
): LabelData {
  return {
    id: Math.random().toString(36).substr(2, 9),
    productName,
    price,
    features: features.filter(f => f.trim()),
  };
}
